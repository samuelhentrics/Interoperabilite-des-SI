<div class="container my-3 demande-page">
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3 tabs-card">
    <div class="d-flex align-items-center gap-3 flex-wrap">
      <div class="client-info d-flex flex-column me-3 text-start">
        <div><strong>Client :</strong> <span class="ms-1">{{ demande?.client_name || 'N/A' }}</span></div>
        <div><strong>Demande N°</strong> <span class="ms-1">{{ numDemande || 'N/A' }}</span></div>
      </div>

      <ul class="nav nav-pills gap-1 header-pills">
        <li class="nav-item">
          <button type="button" class="nav-link" [class.active]="activeTab === 'info'"
            (click)="setTab('info')">Info</button>
        </li>
        <li class="nav-item">
          <button type="button" class="nav-link" [class.active]="activeTab === 'inspection'"
            (click)="setTab('inspection')">Inspection</button>
        </li>
        <li class="nav-item">
          <button type="button" class="nav-link" [class.active]="activeTab === 'devis'"
            (click)="setTab('devis')">Devis</button>
        </li>
        <li class="nav-item">
          <button type="button" class="nav-link" [class.active]="activeTab === 'intervention'"
            (click)="setTab('intervention')">Intervention</button>
        </li>
        <li class="nav-item">
          <button type="button" class="nav-link" [class.active]="activeTab === 'rapport'"
            (click)="setTab('rapport')">Rapport</button>
        </li>
      </ul>
    </div>

    <button class="btn btn-outline-danger" (click)="deleteDemande()" [disabled]="isDeleting()">
      <span *ngIf="!isDeleting()">Supprimer</span>
      <span *ngIf="isDeleting()">Suppression…</span>
    </button>
  </div>


  <!-- INFO -->
  <div *ngIf="activeTab === 'info'">
    <!-- edit demande JSON directly -->
    <div class="row g-3">
      <div class="col-12 col-lg-6">

        <div class="mb-3">
          <label class="form-label">Type</label>
          <input class="form-control" [(ngModel)]="demande.type" [ngModelOptions]="{standalone: true}" name="type-info">
        </div>

        <div class="mb-3">
          <label class="form-label">Commentaire</label>
          <textarea class="form-control big-textarea" [(ngModel)]="demande.commentaire" [ngModelOptions]="{standalone: true}"
            name="commentaire-info"></textarea>
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-end mt-3">
      <button class="btn btn-primary" (click)="saveChange()">Enregistrer</button>
    </div>
  </div>
</div>

<!-- INSPECTION -->
<div *ngIf="activeTab === 'inspection'">
  <div class="row g-3">
    <div class="col-12 col-lg-6">

  <div class="mb-3">
    <label class="form-label">Date inspection</label>
  <input type="date" class="form-control" [(ngModel)]="demande.inspection.date" [ngModelOptions]="{standalone: true}" name="dateInspection">
  </div>

      <div class="mb-3">
        <label class="form-label">Pièces à changer</label>
        <input class="form-control" [(ngModel)]="demande.inspection.piecedefectueuse" [ngModelOptions]="{standalone: true}" name="piecesAChanger"
          placeholder="Liste, références…">
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="mb-3 h-100 d-flex flex-column">
        <label class="form-label">Commentaire</label>
        <textarea class="form-control big-textarea flex-grow-1" [(ngModel)]="demande.inspection.commentaire" [ngModelOptions]="{standalone: true}"
          name="commentaire-inspection"></textarea>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-end mt-3">
    <button class="btn btn-primary" (click)="saveChange()">Enregistrer</button>
  </div>
</div>

<!-- DEVIS -->
<div *ngIf="activeTab === 'devis'">
  <div class="row g-3">
    <div class="col-12 col-lg-6">

      <div class="mb-3">
        <label class="form-label">Prix pièce</label>
  <input type="number" min="0" step="0.01" class="form-control" [(ngModel)]="currentDevis.prixdepiece" [ngModelOptions]="{standalone: true}" name="prixPiece">
      </div>

      <div class="mb-3">
        <label class="form-label">Prix horaire</label>
        <input type="number" min="0" step="0.01" class="form-control" [(ngModel)]="currentDevis.prixhoraire" [ngModelOptions]="{standalone: true}"
          name="prixHoraire">
      </div>

      <div class="mb-3">
        <label class="form-label">Temps estimé</label>
  <input type="number" class="form-control" [(ngModel)]="currentDevis.tempsestime" [ngModelOptions]="{standalone: true}" name="tempsEstime">
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-end mt-3">
    <button class="btn btn-primary" (click)="saveChange()">Enregistrer</button>
  </div>
</div>

<!-- INTERVENTION -->
<div *ngIf="activeTab === 'intervention'">
  <div class="row g-3">
    <div class="col-12 col-lg-6">
      

  <div class="mb-3">
    <label class="form-label">Date intervention</label>
  <input type="date" class="form-control" [(ngModel)]="currentIntervention.date" [ngModelOptions]="{standalone: true}" name="dateIntervention">
  </div>

  <div class="mb-3">
    <label class="form-label">Temps théorique</label>
  <input class="form-control" [(ngModel)]="currentIntervention.tempsTheorique" [ngModelOptions]="{standalone: true}" name="tempsTheorique" placeholder="ex: 3h30">
  </div>

  <div class="mb-3">
    <label class="form-label">Temps réel</label>
  <input class="form-control" [(ngModel)]="currentIntervention.tempsReel" [ngModelOptions]="{standalone: true}" name="tempsReel" placeholder="ex: 4h05">
  </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="mb-3 h-100 d-flex flex-column">
        <label class="form-label">Commentaire</label>
        <textarea class="form-control big-textarea flex-grow-1" [(ngModel)]="currentIntervention.commentaire" [ngModelOptions]="{standalone: true}"
          name="commentaire-intervention"></textarea>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-end mt-3">
    <button class="btn btn-primary" (click)="saveChange()">Enregistrer</button>
  </div>
</div>

<!-- RAPPORT -->
<div *ngIf="activeTab === 'rapport'">
  <div class="row g-3">
    <div class="col-12 col-lg-6">

      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="finInterv" [(ngModel)]="demande.rapport.finIntervention" [ngModelOptions]="{standalone: true}"
          name="finIntervention">
        <label class="form-check-label" for="finInterv">Fin d'intervention</label>
      </div>

      <div class="mb-3">
        <label class="form-label">Commentaire final</label>
        <textarea class="form-control big-textarea" [(ngModel)]="demande.rapport.commentaireFinal" [ngModelOptions]="{standalone: true}"
          name="commentaireFinal"></textarea>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-end mt-3">
    <button class="btn btn-primary" (click)="saveChange()">Enregistrer</button>
  </div>
</div>

<div class="d-flex justify-content-end mt-4">
  <button class="btn btn-success" (click)="fermerDemande()">Fermer la demande</button>
</div>